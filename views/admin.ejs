<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Admin Panel</title>
    <link href="/css/output.css" rel="stylesheet">
</head>
<body class="bg-gray-50 min-h-screen">
<%- include('partials/nav') %>

<div class="bg-gray-100 min-h-screen flex">
    <!-- Sidebar -->
    <aside class="w-64 bg-white border-r min-h-screen p-6 space-y-4 sticky top-0">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">–ê–¥–º–∏–Ω–∫–∞</h2>
        <nav class="space-y-2">
            <button onclick="switchTab('stats', event)" class="tab-button w-full text-left px-4 py-2 rounded hover:bg-gray-200">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            <button onclick="switchTab('users', event)" class="tab-button w-full text-left px-4 py-2 rounded hover:bg-gray-200">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
            <button onclick="switchTab('projects', event)" class="tab-button w-full text-left px-4 py-2 rounded hover:bg-gray-200">üìÅ –ü—Ä–æ–µ–∫—Ç—ã</button>
            <button onclick="switchTab('logs', event)" class="tab-button w-full text-left px-4 py-2 rounded hover:bg-gray-200">üìú –õ–æ–≥–∏</button>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-6">
        <h1 class="text-3xl font-bold mb-8 text-gray-800">–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>

        <!-- Stats -->
        <div id="tab-stats" class="tab-content hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="bg-white shadow-lg rounded-lg p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-2">üë§ –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h2>
                    <p class="text-3xl text-blue-600 font-semibold"><%= stats.totalUsers %></p>
                </div>
                <div class="bg-white shadow-lg rounded-lg p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-2">üìÅ –í—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–æ–≤</h2>
                    <p class="text-3xl text-blue-600 font-semibold"><%= stats.totalProjects %></p>
                </div>
            </div>

            <div class="bg-white shadow-lg rounded-lg p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-3">üÜï –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</h3>
                <ul class="list-disc pl-5 text-gray-700 space-y-1">
                    <% stats.recentUsers.forEach(u => { %>
                        <li><%= u.name %> ‚Äî <%= new Date(u.created_at).toLocaleDateString() %></li>
                    <% }) %>
                </ul>
            </div>
        </div>

        <!-- Users Tab -->
        <div id="tab-users" class="tab-content hidden space-y-6">
            <% users.forEach(user => { %>
                <div class="bg-white shadow-lg rounded-lg p-4">
                    <div class="grid md:grid-cols-[2rem_3rem_1fr_1fr_1fr_1fr_auto_auto] gap-3 items-center">
                        <div class="text-gray-500 font-mono">#<%= user.id %></div>
                        <img src="<%= user.avatar || '/uploads/default-avatar-hq.png' %>" alt="avatar" class="w-12 h-12 rounded border">
                        <form action="/admin/user/update/<%= user.id %>" method="POST" class="contents">
                            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                            <input name="name" value="<%= user.name %>" class="border p-2 rounded w-full" placeholder="–ò–º—è" />
                            <input name="bio" value="<%= user.bio %>" class="border p-2 rounded w-full" placeholder="–û —Å–µ–±–µ" />
                            <select name="role" class="border p-2 rounded w-full">
                                <option value="student" <%= user.role === 1 ? 'selected' : '' %>>Student</option>
                                <option value="teacher" <%= user.role === 3 ? 'selected' : '' %>>Teacher</option>
                                <option value="admin" <%= user.role === 2 ? 'selected' : '' %>>Admin</option>
                            </select>
                            <div class="text-sm text-gray-400 whitespace-nowrap"><%= user.created_at %></div>
                            <button class="bg-blue-500 text-white px-3 py-2 rounded hover:bg-blue-600 cursor-pointer">üíæ</button>
                        </form>
                        <form action="/admin/user/delete/<%= user.id %>" method="POST" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')">
                            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                            <button class="text-red-500 text-lg hover:text-red-700 cursor-pointer">üóëÔ∏è</button>
                        </form>
                    </div>
                </div>
            <% }) %>
        </div>

        <!-- Projects -->
        <div id="tab-projects" class="tab-content hidden">
            <% projects.forEach(project => { %>
                <div class="bg-white shadow-lg rounded-lg p-4 mb-4 space-y-2">
                    <div class="grid md:grid-cols-[2rem_1fr_1fr_auto_1fr_auto_auto] gap-3 items-center">
                        <form action="/admin/project/update/<%= project.id %>" method="POST" class="contents">
                            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                            <div class="text-gray-600 font-mono">#<%= project.id %></div>
                            <input name="title" value="<%= project.title %>" class="border p-2 rounded w-full" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" />
                            <input name="description" value="<%= project.description %>" class="border p-2 rounded w-full" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" />
                            <div class="text-gray-500 text-sm">–ê–≤—Ç–æ—Ä ID: <%= project.user_id %></div>
                            <div class="text-gray-500 text-sm"><%= project.created_at %></div>
                            <button class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 cursor-pointer">üíæ</button>
                        </form>
                        <form action="/admin/project/delete/<%= project.id %>" method="POST" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç?')">
                            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                            <button class="text-red-500 text-lg hover:text-red-700 cursor-pointer">üóëÔ∏è</button>
                        </form>
                    </div>
                </div>
            <% }) %>
        </div>

        <!-- Logs -->
        <div id="tab-logs" class="tab-content hidden">
            <div class="bg-white p-6 rounded shadow-lg max-h-[400px] overflow-y-auto text-sm text-gray-700 space-y-2">
                <% logs.forEach(log => { %>
                    <div class="border-b py-2">
                        <span class="text-gray-500"><%= new Date(log.timestamp).toLocaleString() %></span> ‚Äî
                        <strong><%= log.username || 'System' %></strong>: <%= log.action %>
                    </div>
                <% }) %>
            </div>
        </div>
    </main>
</div>

<script>
    function switchTab(tabId, event) {
        document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
        document.getElementById('tab-' + tabId).classList.remove('hidden');
        document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('bg-gray-200'));
        if (event) event.target.classList.add('bg-gray-200');
    }

    document.addEventListener('DOMContentLoaded', () => {
        switchTab('stats');
    });
</script>
</body>
</html>
